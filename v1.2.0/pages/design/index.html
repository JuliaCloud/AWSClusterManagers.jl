<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Design · AWSClusterManagers.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">AWSClusterManagers.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../docker/">Docker</a></li><li><a class="tocitem" href="../batch/">Batch</a></li><li><a class="tocitem" href="../ecs/">ECS</a></li><li class="is-active"><a class="tocitem" href>Design</a><ul class="internal"><li><a class="tocitem" href="#Networking-Mode"><span>Networking Mode</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Design</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Design</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaCloud/AWSClusterManagers.jl/blob/master/docs/src/pages/design.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Design"><a class="docs-heading-anchor" href="#Design">Design</a><a id="Design-1"></a><a class="docs-heading-anchor-permalink" href="#Design" title="Permalink"></a></h1><p>A little background on the design of the ECSManager and why decisions were made the way they were.</p><p>ECS is fundamentally a way of running Docker containers on EC2. It is quite possible that multiple containers based upon the same image could be running on the same EC2 instance. Since Julia uses TCP connections to talk between the various processes we need to be careful not to use specific port to listen for connection as this would cause conflicts between containers running on the same image. The solution to this problem is to use a &quot;random&quot; port in the ephermal port range that is available.</p><p>Using an ephermal port solves the issue of running into port reservation conflicts but introduces a new issue of having the port number on the newly spawned containers not being deterministic by the process that launched them. Since Julia typically works by having the  manager connecting to the workers this is an issue. The solution implemented is to have the manager open a port to listen to and then include the address and port of itself as part of the task definition using <a href="http://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_StartTask.html">container overrides</a>. This way we can have the worker connect back to the manager.</p><p>Now Julia can use a variety of networking topologies (manager-to-worker or all-to-all). In order to use as much of the built in code as possible we just have the worker report it&#39;s address and port to the manager and then let the manager connect to the worker like in a  typical cluster manager.</p><h2 id="Networking-Mode"><a class="docs-heading-anchor" href="#Networking-Mode">Networking Mode</a><a id="Networking-Mode-1"></a><a class="docs-heading-anchor-permalink" href="#Networking-Mode" title="Permalink"></a></h2><p>The current implementation makes use of Docker &quot;host&quot; networking. This type of networking means we are working directly with the instances network interface instead of having  a virtualized networking interface known as &quot;bridge&quot;. The bridged networking is another way of handling the port reservation problem but leads to other complications including not  knowning the address of the instance in which the container is running. Without that information we cannot talk to containers running on separate instances.</p><p>Additionally, it has been stated that the &quot;host&quot; networking has <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#network_mode">higher performance</a> and allows processes running within containers to reserve ports on the container host. Also, this allows us to access the host instance metadata via <code>curl http://169.254.169.254/latest/meta-data/</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ecs/">« ECS</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 23 September 2021 22:46">Thursday 23 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
